## 虚拟化基本架构

- Hypervisor
- 虚拟CPU
- 虚拟内存
- 虚拟存储
- 虚拟网络接口
- 虚拟I/O
- 快照、镜像、外围设备、虚拟化资源池
- **隔离性、安全性、完整性**

## QEMU开发/软件虚拟化
- QEMU是一款开源模拟器和虚拟机监管器，通过动态二进制翻译来模拟CPU，提供一系列<font  
color="red"  
>硬件模型</font>，使得 guest os 认为自己和硬件直接打交道，其实是与QEMU模型打交道，模型再将这些指令翻译给真正的硬件。
- kvm、qemu

## 硬件虚拟化
- 计算机硬件提供指令让客户机命令独立执行，不需要VMM重定向
- intel在2005年开始在x86 cpu中加入硬件虚拟化支持，简称Intel VT技术


## 半虚拟化与全虚拟化
- 半虚拟化：只模拟底层硬件。这种虚拟化产品的客户机操作系统与本来的操作系统有区别（需要修改才能运行在虚拟机上）
- 全虚拟化：模拟完整底层硬件：处理器、内存、时钟、外设（不做修改可运行）
- 超虚拟化：添加一层（hypervisor）。硬件虚拟或软件虚拟都可用，分为1型和2型
	- 1型——裸金属架构
	- 2型——带hypervisor架构（宿主机架构）
- 用户态到内核态的转变


## KVM——硬件辅助虚拟化
- 有intel VT辅助实现高性能
- 有QEMU操纵实现硬件模拟（KVM只负责最核心的模拟）
- 一个kvm客户机本质是一个进程
- 通过“任何分配不会一次耗尽”实现资源调度

## KVM管理工具
- api：libvirt
- virsh：KVM命令行工具
- virt-manager 图形化管理软件
![[Pasted image 20240704185609.png]]
- virt命令行操控libvirt库实现KVM+qemu的虚拟化

## kvm虚拟机安装
- 使用cockpit
- virt命令行部署
- 借助已存在的虚拟机部署
- 增减内存、cpu、磁盘。开关、快照克隆等
- 三种虚拟机网络结构：桥接（相互访问且联网），nat（客户可以访问宿主，宿主不能访问客户，默认流量转发），仅主机（虚拟机只能连客户机，可以配iptables）
	- 修改方法
```shell
virsh edit vm1
# 改这个xml文件就行
```


## 一个快速创建一堆虚拟机的脚本
- 准备工作
	- 存放配置文件的  kvm.txt
- 编写脚本
	- 对文件的存在情况和格式进行if判断
	- 提取文件中的相关变量——用awk按列拿
	- 完成
